---
title: "Docker Image Optimization: From 266MB to 52MB - Complete Beginner's Guide (Part 1)"
description: "Master Docker image optimization techniques including Alpine Linux, multi-stage builds, .dockerignore, and layer reduction. Learn to build production-ready containers that are 80% smaller."
date: "2025-10-03T01:28:00.000Z"
tags: ["docker", "optimization", "alpine", "multi-stage-builds", "dockerfile"]
published: true
author: "Owais"
category: "Docker"
seo:
  canonical: "https://owais.io/blog/docker-image-optimization-fundamentals-part1"
  keywords: ["docker optimization", "docker image size", "alpine linux docker", "multi-stage builds", "dockerignore", "docker best practices"]
toc: true
---

Large Docker images slow down deployments, waste storage, and increase security vulnerabilities. This comprehensive guide teaches you proven optimization techniques to reduce image sizes by up to 80% while maintaining functionality and improving performance.

<Callout type="info">
üéØ **What You'll Learn**: In this hands-on tutorial, you'll discover:
- Building unoptimized vs optimized Docker images and comparing sizes
- Using Alpine Linux for minimal base images
- Implementing multi-stage builds for production efficiency
- Creating effective .dockerignore files to exclude unnecessary content
- Adding metadata with LABEL instructions
- Layer optimization and caching strategies
- Real-world size comparisons (266MB ‚Üí 52MB reduction!)
</Callout>

## üöÄ Why Image Optimization Matters

Docker image size directly impacts:

<div className="overflow-x-auto my-6">
  <table className="min-w-full border-collapse border border-gray-300 dark:border-gray-700">
    <thead className="bg-gray-50 dark:bg-gray-800">
      <tr>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Factor</th>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Unoptimized Impact</th>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Optimized Benefit</th>
      </tr>
    </thead>
    <tbody>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Deployment Speed</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Slower push/pull times</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">5-10x faster deployments</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Storage Costs</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Higher registry costs</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">80% storage reduction</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Security</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">More attack surface</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Minimal attack vectors</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Network Usage</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">High bandwidth consumption</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Reduced transfer costs</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Startup Time</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Longer container starts</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Near-instant startup</td>
      </tr>
    </tbody>
  </table>
</div>

<div className="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900 dark:to-indigo-900 p-6 rounded-lg my-6">

### Prerequisites

Before we begin, make sure you have:
- Docker installed and running
- Basic understanding of Dockerfile syntax
- Terminal access with Docker permissions
- A text editor for creating files

</div>

## üìÅ Step 1: Create Project Structure

Set up a dedicated directory for this optimization lab:

```bash title="Create Project Directory"
mkdir docker-optimization
cd docker-optimization
```

This creates a clean workspace for all our optimization experiments.

## üåê Step 2: Create a Simple Web Application

Create a basic HTML file that we'll serve using Nginx:

```bash title="Create HTML File"
cat > index.html << 'EOF'
<!DOCTYPE html>
<html>
<head>
    <title>Docker Optimization Lab</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { color: #2c3e50; }
        .info { background: #ecf0f1; padding: 20px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Welcome to Docker Optimization Lab</h1>
        <div class="info">
            <p>This is a sample web application running in a Docker container.</p>
            <p>Image optimization techniques help reduce size and improve performance.</p>
        </div>
    </div>
</body>
</html>
EOF
```

**What this does:**
- Creates a simple, self-contained HTML file
- Includes inline CSS for styling
- No external dependencies required
- Perfect for demonstrating image optimization

## ‚ùå Step 3: Build an Unoptimized Image (The Wrong Way)

Let's first build an image the wrong way to understand what NOT to do:

```bash title="Create Unoptimized Dockerfile"
cat > Dockerfile.unoptimized << 'EOF'
FROM ubuntu:20.04

RUN apt-get update

RUN apt-get install -y nginx

RUN apt-get install -y curl

RUN apt-get install -y vim

RUN apt-get clean

RUN rm /var/www/html/index.nginx-debian.html

COPY index.html /var/www/html/

EXPOSE 80

CMD [ "nginx", "-g", "daemon off;" ]
EOF
```

### Understanding the Problems

<div className="overflow-x-auto my-6">
  <table className="min-w-full border-collapse border border-gray-300 dark:border-gray-700">
    <thead className="bg-gray-50 dark:bg-gray-800">
      <tr>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Issue</th>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Problem</th>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Impact</th>
      </tr>
    </thead>
    <tbody>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>{`FROM ubuntu:20.04`}</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Heavy base image (~75MB)</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Unnecessary bulk</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Multiple <code>RUN</code> commands</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Creates separate layers</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Larger final size</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Installing vim, curl</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Unnecessary tools</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Wasted space</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>apt-get clean</code> separate</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Cache already in layers</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Cleanup doesn't reduce size</td>
      </tr>
    </tbody>
  </table>
</div>

### Build the Unoptimized Image

```bash title="Build Unoptimized Image"
docker build -f Dockerfile.unoptimized -t webapp-unoptimized:v1 .
```

**Expected Output:**
```
[+] Building 68.3s (13/13) FINISHED
 => [internal] load build definition from Dockerfile.unoptimized        0.1s
 => [internal] load metadata for docker.io/library/ubuntu:20.04         0.0s
 => [1/8] FROM docker.io/library/ubuntu:20.04                           0.0s
 => [2/8] RUN apt-get update                                           13.1s
 => [3/8] RUN apt-get install -y nginx                                 23.1s
 => [4/8] RUN apt-get install -y curl                                  15.8s
 => [5/8] RUN apt-get install -y vim                                   13.5s
 => [6/8] RUN apt-get clean                                             0.4s
 => [7/8] RUN rm /var/www/html/index.nginx-debian.html                 0.5s
 => [8/8] COPY index.html /var/www/html/                               0.1s
 => exporting to image                                                  1.3s
```

**Build time: 68.3 seconds** - Notice how long it takes!

### Check the Image Size

```bash title="Check Unoptimized Image Size"
docker images webapp-unoptimized:v1
```

**Output:**
```
REPOSITORY           TAG       IMAGE ID       CREATED              SIZE
webapp-unoptimized   v1        4290998e4fdf   About a minute ago   266MB
```

**Result: 266MB!** This is enormous for a simple static website.

<Callout type="warning">
‚ö†Ô∏è **Why 266MB is Too Large**: For serving a single HTML file, 266MB is wasteful. This includes the entire Ubuntu system, package manager caches, and unnecessary utilities like vim and curl.
</Callout>

## ‚úÖ Step 4: Build an Optimized Image (The Right Way)

Now let's create a properly optimized Dockerfile:

```bash title="Create Optimized Dockerfile"
cat > Dockerfile.optimized << 'EOF'
FROM nginx:alpine

COPY index.html /usr/share/nginx/html/

EXPOSE 80
EOF
```

### Why This is Better

<div className="overflow-x-auto my-6">
  <table className="min-w-full border-collapse border border-gray-300 dark:border-gray-700">
    <thead className="bg-gray-50 dark:bg-gray-800">
      <tr>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Optimization</th>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Benefit</th>
      </tr>
    </thead>
    <tbody>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>{`nginx:alpine`}</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Minimal base (~5MB vs 75MB)</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Nginx pre-installed</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">No installation overhead</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Single COPY instruction</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Minimal layers</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">No unnecessary tools</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Smaller attack surface</td>
      </tr>
    </tbody>
  </table>
</div>

### Build the Optimized Image

```bash title="Build Optimized Image"
docker build -f Dockerfile.optimized -t webapp-optimized:v1 .
```

**Expected Output:**
```
[+] Building 0.7s (7/7) FINISHED
 => [internal] load build definition from Dockerfile.optimized          0.1s
 => [internal] load metadata for docker.io/library/nginx:alpine         0.0s
 => [1/2] FROM docker.io/library/nginx:alpine                           0.2s
 => [2/2] COPY index.html /usr/share/nginx/html/                        0.1s
 => exporting to image                                                  0.1s
```

**Build time: 0.7 seconds** - 97x faster!

### Compare Image Sizes

```bash title="Compare Both Images"
docker images | grep webapp
```

**Output:**
```
webapp-optimized     v1        c6ae8c7db208   15 seconds ago   52.5MB
webapp-unoptimized   v1        4290998e4fdf   3 minutes ago    266MB
```

<div className="bg-gradient-to-br from-green-50 to-blue-50 dark:from-green-900 dark:to-blue-900 p-6 rounded-lg my-8">

### üéâ **Optimization Result**

**Size Reduction: 266MB ‚Üí 52.5MB**
- **80.3% smaller**
- **5x smaller image**
- **97x faster build time**

Same functionality, fraction of the size!

</div>

## üèóÔ∏è Step 5: Multi-Stage Builds for Node.js Applications

For applications with build dependencies, multi-stage builds are essential. Let's create a Node.js example:

### Create Node.js Application Files

```bash title="Create package.json"
cat > package.json << 'EOF'
{
  "name": "docker-optimization-demo",
  "version": "1.0.0",
  "description": "Demo app for Docker optimization",
  "main": "server.js",
  "scripts": {
    "start": "node server.js"
  },
  "dependencies": {
    "express": "^4.18.0"
  }
}
EOF
```

```bash title="Create server.js"
cat > server.js << 'EOF'
const express = require('express');
const path = require('path');
const app = express();
const PORT = 3000;

// Serve static files
app.use(express.static('.'));

app.get('/', (req, res) => {
    res.sendFile(path.join(__dirname, 'index.html'));
});

app.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
});
EOF
```

### Create Multi-Stage Dockerfile

```bash title="Create Multi-Stage Dockerfile"
cat > Dockerfile.multistage << 'EOF'
FROM node:16-alpine AS builder

WORKDIR /app

COPY package*.json ./

RUN npm install --only=production

FROM node:16-alpine AS production

WORKDIR /app

COPY --from=builder /app/node_modules ./node_modules

COPY package*.json ./

COPY server.js ./

COPY index.html ./

RUN addgroup -g 1001 -S nodejs && adduser -S nodejs -u 1001

USER nodejs

EXPOSE 3000

CMD [ "npm", "start" ]
EOF
```

### Understanding Multi-Stage Builds

<div className="overflow-x-auto my-6">
  <table className="min-w-full border-collapse border border-gray-300 dark:border-gray-700">
    <thead className="bg-gray-50 dark:bg-gray-800">
      <tr>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Stage</th>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Purpose</th>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">What Happens</th>
      </tr>
    </thead>
    <tbody>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><strong>Stage 1 - builder</strong></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Build environment</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Installs dependencies</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><strong>Stage 2 - production</strong></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Runtime environment</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Copies only needed files</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>COPY --from=builder</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Selective copying</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Takes only node_modules</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>USER nodejs</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Security</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Non-root user execution</td>
      </tr>
    </tbody>
  </table>
</div>

### Build Multi-Stage Image

```bash title="Build Multi-Stage Image"
docker build -f Dockerfile.multistage -t webapp-multistage:v1 .
```

**Expected Output (abbreviated):**
```
[+] Building 21.4s (14/14) FINISHED
 => [internal] load build definition from Dockerfile.multistage         0.0s
 => [internal] load metadata for docker.io/library/node:16-alpine       3.2s
 => [builder 1/4] FROM docker.io/library/node:16-alpine                10.0s
 => [builder 2/4] WORKDIR /app                                          0.4s
 => [builder 3/4] COPY package*.json ./                                 0.1s
 => [builder 4/4] RUN npm install --only=production                     5.3s
 => [production 3/7] COPY --from=builder /app/node_modules ./node_modules  0.2s
 => [production 4/7] COPY package*.json ./                              0.1s
 => [production 5/7] COPY server.js ./                                  0.1s
 => [production 6/7] COPY index.html ./                                 0.1s
 => [production 7/7] RUN addgroup -g 1001 -S nodejs && adduser -S nodejs -u 1001  0.5s
 => exporting to image                                                  1.0s
```

### Compare All Three Images

```bash title="View All Image Sizes"
docker images | grep webapp
```

**Output:**
```
webapp-multistage    v1        258c77de1c40   15 seconds ago   120MB
webapp-optimized     v1        c6ae8c7db208   21 minutes ago   52.5MB
webapp-unoptimized   v1        4290998e4fdf   24 minutes ago   266MB
```

**Analysis:**
- **Unoptimized**: 266MB (baseline)
- **Multi-stage**: 120MB (55% reduction)
- **Alpine optimized**: 52.5MB (80% reduction)

<Callout type="info">
üí° **Why Multi-Stage is Larger**: The Node.js multi-stage image is larger because it includes the Node.js runtime and Express dependencies. However, it's still 55% smaller than a single-stage build would be!
</Callout>

## üö´ Step 6: Using .dockerignore for Cleaner Builds

The `.dockerignore` file prevents unnecessary files from being added to your image.

### Create Dummy Files (Don't Include These!)

```bash title="Create Files That Shouldn't Be in Images"
mkdir logs
echo "Error log content" > logs/error.log
echo "Access log content" > logs/access.log
echo "Temporary data" > temp.txt
echo "Cache data" > cache.tmp
mkdir .git
echo "Git repository data" > .git/config
mkdir docs
echo "# Documentation" > docs/README.md
mkdir node_modules_dev
echo "Development dependencies" > node_modules_dev/dev-package.js
```

### Build Without .dockerignore

```bash title="Build Without Ignoring Files"
docker build -f Dockerfile.optimized -t webapp-with-junk:v1 .
```

The build includes ALL files in the directory (wasteful).

### Create .dockerignore File

```bash title="Create .dockerignore"
cat > .dockerignore << 'EOF'
# Logs
logs/
*.log

# Temporary files
*.tmp
temp.txt

# Version control
.git/
.gitignore

# Development dependencies
node_modules_dev/

# Documentation (not needed in production)
docs/
README.md

# IDE files
.vscode/
.idea/

# OS generated files
.DS_Store
Thumbs.db

# Docker files (don't include other Dockerfiles)
Dockerfile.*
!Dockerfile.optimized

# Build artifacts
dist/
build/
EOF
```

### Understanding .dockerignore Patterns

<div className="overflow-x-auto my-6">
  <table className="min-w-full border-collapse border border-gray-300 dark:border-gray-700">
    <thead className="bg-gray-50 dark:bg-gray-800">
      <tr>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Pattern</th>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Meaning</th>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Example</th>
      </tr>
    </thead>
    <tbody>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>logs/</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Ignore directory</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Excludes entire logs folder</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>*.log</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Wildcard pattern</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">All files ending in .log</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>temp.txt</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Specific file</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Only that exact file</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>Dockerfile.*</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Prefix wildcard</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">All Dockerfile variants</td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>!Dockerfile.optimized</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Exception (include)</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Include this specific file</td>
      </tr>
    </tbody>
  </table>
</div>

### Build With .dockerignore

```bash title="Build Clean Image"
docker build -f Dockerfile.optimized -t webapp-clean:v1 .
```

### Verify Excluded Files

```bash title="Check What's Inside Container"
docker run --rm webapp-clean:v1 ls -la /usr/share/nginx/html/
```

**Output:**
```
total 8
drwxr-xr-x    1 root     root            24 Oct  2 19:04 .
drwxr-xr-x    1 root     root            18 Aug 13 18:52 ..
-rw-r--r--    1 root     root           497 Aug 13 15:10 50x.html
-rw-r--r--    1 root     root           661 Oct  2 18:53 index.html
```

**Success!** Only index.html was copied - no logs, no temp files, no git data!

## üè∑Ô∏è Step 7: Adding Metadata with LABEL

Labels provide important metadata about your images:

```bash title="Create Dockerfile with Labels"
cat > Dockerfile << 'EOF'
FROM nginx:alpine

LABEL maintainer="owais.abbasi9@gmail.com"
LABEL version="1.0"
LABEL description="Optimized web application for Docker practice"

COPY index.html /usr/share/nginx/html/

RUN echo 'server { \
    listen 80; \
    server_name localhost; \
    location / { \
        root /usr/share/nginx/html; \
        index index.html; \
    } \
    # Security headers \
    add_header X-Frame-Options "SAMEORIGIN" always; \
    add_header X-Content-Type-Options "nosniff" always; \
}' > /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD [ "nginx", "-g", "daemon off;" ]
EOF
```

### Build Labeled Image

```bash title="Build Image with Metadata"
docker build -t mywebapp:1.0.0 .
```

**Expected Output:**
```
[+] Building 0.9s (8/8) FINISHED
 => [internal] load build definition from Dockerfile                   0.0s
 => [1/3] FROM docker.io/library/nginx:alpine                          0.0s
 => [2/3] COPY index.html /usr/share/nginx/html/                       0.0s
 => [3/3] RUN echo 'server { ... }' > /etc/nginx/conf.d/default.conf   0.5s
 => exporting to image                                                 0.1s
```

<Callout type="success">
‚úÖ **Benefits of Labels**: Labels make images discoverable, document usage, and enable automation tools to process images intelligently.
</Callout>

## üéØ Optimization Best Practices

<div className="bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-900 dark:to-blue-900 p-6 rounded-lg my-8">

### 1. **Choose the Right Base Image**
- Use Alpine Linux variants when possible (`nginx:alpine`, `node:alpine`)
- Choose minimal official images
- Avoid general-purpose OS images (Ubuntu, CentOS) unless necessary

### 2. **Minimize Layers**

Combine multiple RUN commands into one to reduce layers.

### 3. **Use Multi-Stage Builds**
- Separate build and runtime dependencies
- Copy only artifacts needed for production
- Reduces final image size significantly

### 4. **Leverage .dockerignore**
- Exclude logs, temp files, and documentation
- Don't include version control files
- Skip development dependencies

### 5. **Order Instructions Wisely**
- Place frequently changing instructions last
- Copy dependency files before source code
- Maximizes layer caching

### 6. **Clean Up in Same Layer**

Always clean up package manager caches in the same RUN command where you install packages.

### 7. **Use Specific Tags**

Always use specific version tags instead of `latest` for reproducible builds.

### 8. **Remove Unnecessary Packages**
- Only install what you need
- Avoid including debug tools in production images
- Use `--no-install-recommends` with apt-get

</div>

**Layer Minimization Examples:**

```dockerfile
# Bad - 3 layers
RUN apt-get update
RUN apt-get install -y nginx
RUN apt-get clean

# Good - 1 layer
RUN apt-get update && \
    apt-get install -y nginx && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*
```

**Cleanup in Same Layer:**

```dockerfile
# Bad - cleanup in different layer (doesn't reduce size)
RUN apt-get install -y package
RUN apt-get clean

# Good - cleanup in same layer
RUN apt-get install -y package && apt-get clean
```

**Use Specific Tags:**

```dockerfile
# Bad - unpredictable
FROM node:latest

# Good - reproducible
FROM node:16-alpine
```

## üìä Command Reference Cheat Sheet

<div className="overflow-x-auto my-6">
  <table className="min-w-full border-collapse border border-gray-300 dark:border-gray-700">
    <thead className="bg-gray-50 dark:bg-gray-800">
      <tr>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Command</th>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Purpose</th>
        <th className="border border-gray-300 dark:border-gray-700 px-4 py-2 text-left font-semibold">Example</th>
      </tr>
    </thead>
    <tbody>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>{`docker build -f [file] -t [tag] .`}</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Build with specific Dockerfile</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>{`docker build -f Dockerfile.optimized -t app:v1 .`}</code></td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>docker images</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">List all images</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>docker images | grep webapp</code></td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>{`docker run --rm [image] [cmd]`}</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Run command and remove container</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>{`docker run --rm app:v1 ls /app`}</code></td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>docker history [image]</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">View image layers</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>{`docker history webapp:v1`}</code></td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>docker inspect [image]</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">View detailed metadata</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>{`docker inspect webapp:v1`}</code></td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>docker rmi [image]</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Remove image</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>{`docker rmi webapp:v1`}</code></td>
      </tr>
      <tr className="hover:bg-gray-50 dark:hover:bg-gray-800">
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>docker system prune -f</code></td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2">Clean up unused resources</td>
        <td className="border border-gray-300 dark:border-gray-700 px-4 py-2"><code>docker system prune -f</code></td>
      </tr>
    </tbody>
  </table>
</div>

## üéì Key Takeaways

<div className="bg-gradient-to-br from-green-50 to-blue-50 dark:from-green-900 dark:to-blue-900 p-6 rounded-lg my-8">

### ‚úÖ Remember These Points

1. **Alpine Linux** reduces base image size by 80-90%
2. **Multi-stage builds** separate build-time and runtime dependencies
3. **.dockerignore** prevents unnecessary files from entering images
4. **Layer consolidation** reduces final image size
5. **Specific base image tags** ensure reproducible builds
6. **Labels** provide essential metadata for automation
7. **Optimization** improves deployment speed, reduces costs, and enhances security

</div>

## üöÄ What's Next?

In Part 2, we'll cover:
- Image tagging strategies and version management
- Pushing images to Docker Hub
- Pulling and deploying from registries
- Running containers with environment variables and volumes
- Container monitoring and resource usage
- Troubleshooting common issues

## üìñ Further Reading

### Official Resources
- [Docker Best Practices](https://docs.docker.com/develop/dev-best-practices/)
- [Dockerfile Reference](https://docs.docker.com/engine/reference/builder/)
- [Multi-Stage Builds](https://docs.docker.com/build/building/multi-stage/)

---

<Callout type="success">
üéâ **Excellent Work!** You've learned to optimize Docker images from 266MB down to 52MB - an 80% reduction! You now understand Alpine Linux, multi-stage builds, .dockerignore files, and layer optimization.

**Next Steps**: Practice these techniques on your own applications and get ready for Part 2 where we'll push these optimized images to Docker Hub!
</Callout>

## üí¨ Discussion

Share your optimization wins:

- What size reductions have you achieved?
- Which optimization technique surprised you most?
- What challenges did you face with multi-stage builds?
- How are you applying these in production?

**Connect with me**:
- üêô [GitHub](https://github.com/owais-io) - Docker optimization examples
- üìß [Contact](https://owais.io/contact) - Questions and discussions
